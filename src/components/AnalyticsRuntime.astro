---
/* src/components/AnalyticsRuntime.astro */
---
<script>
  (function () {
    if (window.__analyticsDelegationBound__) return;
    window.__analyticsDelegationBound__ = true;

    document.addEventListener('click', function (e) {
      var el = e.target && e.target.closest ? e.target.closest('[data-analytics]') : null;
      if (!el) return;

      var name = el.getAttribute('data-analytics');
      if (!name) return;

      var raw = el.getAttribute('data-analytics-payload');
      var props;
      try { props = raw ? JSON.parse(raw) : undefined; } catch (_) {}

      if (typeof window.plausible === 'function') {
        window.plausible(name, props ? { props: props } : undefined);
      }
    }, { capture: true });
  })();
</script>
