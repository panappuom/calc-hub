---
import "../styles/global.css";
import Footer from "../components/Footer.astro";
import data from "../data/deals.json";
import { formatCopy, safeBreak } from "../lib/safe-break";
const BASE_URL = import.meta.env.BASE_URL;
const items = (data?.items ?? []).slice(0, 100);
function fmt(d){ try{ return new Date(d).toLocaleString(); }catch{ return d; } }
---
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <base href={BASE_URL} />
    <title>今日のセール・割引まとめ</title>
  </head>
  <body>
    <div class="wrap">
      <a href="./" class="small">← トップ</a>
      <h1 set:html={safeBreak("今日のセール・割引まとめ")}></h1>
      <p
        class="small jp-copy"
        set:html={formatCopy("主要サイトの公式情報から毎日自動で集めています。ノイズ（求人・PR等）は除外。")}
      ></p>
      <div class="grid" style="margin-top:8px">
        {items.map((it) => (
          <a
            class="card"
            href={it.link}
            target="_blank"
            rel="nofollow noopener"
            title={`${it.source}で詳細を確認できます（新しいタブが開きます）`}
          >
            <h2 style="margin:0 0 6px 0" set:html={safeBreak(it.title)}></h2>
            <p
              class="small jp-copy"
              style="margin:0 0 6px 0"
              set:html={formatCopy(`${it.source} / ${fmt(it.date)}`)}
            ></p>
            {it.description && (
              <p class="jp-copy" style="margin:0" set:html={formatCopy(it.description)}></p>
            )}
          </a>
        ))}
      </div>
      <p
        class="small jp-copy"
        style="margin-top:8px"
        set:html={formatCopy("価格・在庫は変動します。最新情報はリンク先でご確認ください。")}>
      </p>
    </div>
    <Footer />
  </body>
</html>
